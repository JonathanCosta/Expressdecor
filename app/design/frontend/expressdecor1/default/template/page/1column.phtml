<?php

/**

 * Magento Enterprise Edition

 *

 * NOTICE OF LICENSE

 *

 * This source file is subject to the Magento Enterprise Edition License

 * that is bundled with this package in the file LICENSE_EE.txt.

 * It is also available through the world-wide-web at this URL:

 * http://www.magentocommerce.com/license/enterprise-edition

 * If you did not receive a copy of the license and are unable to

 * obtain it through the world-wide-web, please send an email

 * to license@magentocommerce.com so we can send you a copy immediately.

 *

 * DISCLAIMER

 *

 * Do not edit or add to this file if you wish to upgrade Magento to newer

 * versions in the future. If you wish to customize Magento for your

 * needs please refer to http://www.magentocommerce.com for more information.

 *

 * @category    design

 * @package     enterprise_default

 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)

 * @license     http://www.magentocommerce.com/license/enterprise-edition

 */

?>

<?php
/*
* Template for Mage_Page_Block_Html
*/
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<?php echo $this->getLang() ?>" lang="<?php echo $this->getLang() ?>">

<head>

<?php echo $this->getChildHtml('head') ?>

</head>

<body<?php echo $this->getBodyClass()?' class="'.$this->getBodyClass().'"':'' ?>>

<?php echo $this->getChildHtml('after_body_start') ?>


<div class="wrapper">

<?php 
date_default_timezone_set('America/New_York');
$hours=array();
$hours=Mage::getStoreConfig('expressdecor/customer_service/service_hours',Mage::app()->getStore());
$hours=json_decode($hours);
$day=date('D');

$last_day=date("D",strtotime("yesterday"));
if (strpos($hours->customer_service_time->$last_day->end,'+')>0) {

	$end_time_config_last=$hours->customer_service_time->$last_day->end;
	$end_time_config_last=str_replace('+','',$end_time_config_last);
	
	$h_l=substr($end_time_config_last,0,strpos($end_time_config_last,':'));
	$m_l=substr($end_time_config_last,strpos($end_time_config_last,':')+1,strlen($end_time_config_last)-strpos($end_time_config_last,':')-1);
	
	if (strtotime(date("M-d-Y H:i:s"))<mktime($h_l,$m_l,date("s"),date("m"),date("d"),date("Y"))) {
		$day=$last_day;
	}
}



$is_open=Mage::getModel('core/session')->getNeedHelp();

$end_time_config=$hours->customer_service_time->$day->end;
$start_date=strtotime($hours->customer_service_time->$day->start);

if(strpos($end_time_config,"+")>0)
{
	
	$end_time_config=str_replace('+','',$end_time_config);
	$h=substr($end_time_config,0,strpos($end_time_config,':'));
	$m=substr($end_time_config,strpos($end_time_config,':')+1,strlen($end_time_config)-strpos($end_time_config,':')-1);
	$end_time=mktime($h,$m,date("s"),date("m"),date("d")+1,date("Y"));
	$start_date='0:00';
	
} else {
	$h=substr($end_time_config,0,strpos($end_time_config,':'));
	$m=substr($end_time_config,strpos($end_time_config,':')+1,strlen($end_time_config)-strpos($end_time_config,':')-1);
	$end_time=mktime($h,$m,date("s"),date("m"),date("d"),date("Y"));
	
}
if (!isset($is_open)) {
	if ( ($start_date < strtotime(date('H:i')) ) && ( strtotime(date("M-d-Y H:i:s")) < $end_time )  ) {
		$is_open=1;
		Mage::getModel('core/session')->setNeedHelp(1);
	} else {
		$is_open=0;
		Mage::getModel('core/session')->setNeedHelp(0);
	}
}



?>
<div <?php if ($is_open==1) { echo 'class="open"'; }?> id="tabout-left-<?php if ( ($start_date < strtotime(date('H:i')) ) && ( strtotime(date("M-d-Y H:i:s")) < $end_time) ) {   ?>aviable<?php } else {   ?>off<?php } ?>" >          
    <div id="handle">   
    </div>    
    <div onclick='simulate(document.getElementById("handle"), "click");' id="express_hide"></div>
<div class="express-title">Customer Service</div>
<?php if ( ($start_date < strtotime(date('H:i')) ) && ( strtotime(date('H:i')) < $end_time) ) {   ?>
    <a onclick="lpButtonCTTUrl = 'https://server.iad.liveperson.net/hc/33660894/?cmd=file&amp;file=visitorWantsToChat&amp;site=33660894&amp;imageUrl=https://www.expressdecor.com/templates/ed_new/img/liveperson&amp;referrer='+escape(document.location); lpButtonCTTUrl = (typeof(lpAppendVisitorCookies) != 'undefined' ? lpAppendVisitorCookies(lpButtonCTTUrl) : lpButtonCTTUrl); lpButtonCTTUrl = ((typeof(lpMTag)!='undefined' &amp;&amp; typeof(lpMTag.addFirstPartyCookies)!='undefined')?lpMTag.addFirstPartyCookies(lpButtonCTTUrl):lpButtonCTTUrl);window.open(lpButtonCTTUrl,'chat33660894','width=475,height=400,resizable=yes');return false;" href="https://server.iad.liveperson.net/hc/33660894/?cmd=file&amp;file=visitorWantsToChat&amp;site=33660894&amp;byhref=1&amp;imageUrl=https://www.expressdecor.com/templates/ed_new/img/liveperson">
      <div class="livechat-img-custom" ></div>
                 </a> 
           <div class="livechat-img-right-custom" ></div>
    <?php } else {   ?>
    <div class="express-offline">Currently offline</div>
     <div class="express-email"><a href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>contacts" >
    Send us an Email
      </a> </div>
    <?php } ?>
	     

           <div class="express-text">Hours of Operation:</div>
           <div class="express-text"> Today <? echo date('g A',strtotime($hours->customer_service_time->$day->start))?>  to  <?=date('g A',$end_time)?> EST </div>    
</div>

<script type="text/javascript">Event.observe('handle', 'click',Element.toggleClassName.curry("tabout-left-<?php if ( ($start_date < strtotime(date('H:i')) ) && (  strtotime(date("M-d-Y H:i:s")) < $end_time) ) {   ?>aviable<?php } else {   ?>off<?php } ?>", 'open'));</script>

<?php 
if ($is_open==1) {

	?>
 
	<script type="text/javascript">
	Event.observe('handle', 'click',function(event) {
		new Ajax.Request('/set_session.php',
		{
			method:'get',
			parameters: {customer_show: 0}
		});

	});
</script>

<?php }  ?>
 <!--<div class="header-bg">

       

    </div>-->

    <?php echo $this->getChildHtml('global_notices') ?>

    <div class="page">

        <?php echo $this->getChildHtml('header') ?>

        <?php echo $this->getChildHtml('global_messages') ?>

        <?php echo $this->getChildHtml('breadcrumbsContainer') ?>

        <div class="main col1-layout">

            <div class="col-main">

                <?php echo $this->getChildHtml('content') ?>

            </div>

        </div>

        <?php echo $this->getChildHtml('footer_before') ?>

        <?php echo $this->getChildHtml('footer') ?>

        <?php echo $this->getChildHtml('before_body_end') ?>

    </div>

</div>

<?php echo $this->getAbsoluteFooter() ?>

</body>

</html>

