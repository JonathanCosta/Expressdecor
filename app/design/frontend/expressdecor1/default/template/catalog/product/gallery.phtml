<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php $_width=$this->getImageWidth() ?>
      <script type="text/javascript">
      function change_main_image(img, width) {
      	document.getElementById('product-gallery-image').src=img;
      	if (width> <?php echo $_width ?>) {
      		document.getElementById('product-gallery-image').width=<?php echo $_width ?>;
      	} else {
      		document.getElementById('product-gallery-image').width=width;
      	}
      }
      </script>
<div class="product-image-popup" style="width:<?php echo $_width; ?>px;">
    <div class="buttons-set"><a href="#" onclick="window.close(); return false;" class="button"><span><?php echo $this->__('Close Window') ?></span></a></div>
<center>
    <div id="express-images" class="carousel">
                <div class="button navButton previous" style="display:none;">Back</div>
                <div class="button navButton next" style="display:none;">More</div>
                <div class="container">
                  <div class="items">
                <?php				
                foreach ($this->getProduct()->getMediaGalleryImages() as $_image):
                $size=getimagesize($_image->getPath());
                $src= $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(48);
                if ( strpos($src,'thumbnail.jpg') === false)  {
    	?>               
                  <div class="item">
                     <div class="key caption"></div>                            
                     <div class="icon">
                        <a href="#"  onclick="change_main_image('<?php echo  $_image->getUrl(); ?>','<?php echo $size[0]; ?>');"  title="Click to enlarge" > 
                        <img   src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(48); ?>" width="48" height="48" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" />
                        </a>
                     </div>                            
                     <div class="picture">
                        <a href="#"  onclick="change_main_image('<?php echo $_image->getUrl(); ?>','<?php echo $size[0]; ?>');"  title="Click to enlarge">      
                        <img   src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(48); ?>" width="48" height="48" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" />  
                        </a>
                     </div>
                  </div>
             <?php 
                }
    endforeach; ?>         
                 </div>                            
                </div>
   </div>
          </center>              
    
    <?php if($_imageTitle = $this->htmlEscape($this->getCurrentImage()->getLabel())): ?>
        <h1 class="image-label"><?php echo $_imageTitle ?></h1>
    <?php endif; ?>
    
    <img src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'image', $this->getImageFile()); ?>"<?php if($_width): ?> width="<?php echo $_width ?>"<?php endif; ?> alt="<?php echo $this->htmlEscape($this->getCurrentImage()->getLabel()) ?>" title="<?php echo $this->htmlEscape($this->getCurrentImage()->getLabel()) ?>" id="product-gallery-image" class="image" />
    
    <div class="buttons-set"><a href="#" onclick="window.close(); return false;" class="button"><span><?php echo $this->__('Close Window') ?></span></a></div>
    <center>
      <div id="express-images" class="carousel">
                <div class="button navButton previous" style="display:none;">Back</div>
                <div class="button navButton next" style="display:none;">More</div>
                <div class="container">
                  <div class="items">
                <?php				
                foreach ($this->getProduct()->getMediaGalleryImages() as $_image):
                $size=getimagesize($_image->getPath());
                $src= $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(48);
                if ( strpos($src,'thumbnail.jpg') === false)  {
    	?>               
                  <div class="item">
                     <div class="key caption"></div>                            
                     <div class="icon">
                        <a href="#"  onclick="change_main_image('<?php echo  $_image->getUrl(); ?>','<?php echo $size[0]; ?>');"  title="Click to enlarge" > 
                        <img   src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(48); ?>" width="48" height="48" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" />
                        </a>
                     </div>                            
                     <div class="picture">
                        <a href="#"  onclick="change_main_image('<?php echo $_image->getUrl(); ?>','<?php echo $size[0]; ?>');"  title="Click to enlarge">      
                        <img   src="<?php echo $this->helper('catalog/image')->init($this->getProduct(), 'thumbnail', $_image->getFile())->resize(48); ?>" width="48" height="48" alt="<?php echo $this->htmlEscape($_image->getLabel()) ?>" />  
                        </a>
                     </div>
                  </div>
             <?php 
                }
    endforeach; ?>         
                 </div>                            
                </div>
   </div>
    </center>
</div>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){
	var demensions = $('product-gallery-image').getDimensions();
	if (demensions.width < 300) {
		demensions.width = 300
	}
	window.resizeTo(demensions.width+90, demensions.height+210);
});
//]]>
</script>
