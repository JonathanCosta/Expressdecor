	<div><img src="/templates/ed_new/img/account-top.png" style="margin-left: 25px;" alt="" /></div>
	<?php if ($messageStack->size('account') > 0) { ?>
	<div><?php echo $messageStack->output('account'); ?></div>
	<?php } ?>
	
	<?php if (tep_count_customer_orders() > 0) { ?>
	<div class="account-block border">
		<div class="header">My Orders</div>
		<div class="content">
			<table cellpadding="4" cellspacing="0" class="orders">
				<tr>
					<th style="width: 170px;">Order number</th>
					<th style="width: 205px;">Date of Purchase</th>
					<th style="width: 100px;">Paid Amount</th>
					<th style="width: 158px;">Status</th>
					<th>&nbsp;</th>
				</tr>
			</table>
			<div class="orders-listing">
			<table cellpadding="4" cellspacing="0" class="orders">
	<?php 
		$orders_query = tep_db_query("select o.orders_id, o.date_purchased, o.delivery_name, o.delivery_country, o.billing_name, o.billing_country, ot.text as order_total, s.orders_status_name from " . TABLE_ORDERS . " o, " . TABLE_ORDERS_TOTAL . " ot, " . TABLE_ORDERS_STATUS . " s where o.customers_id = '" . (int)$customer_id . "' and o.orders_id = ot.orders_id and ot.class = 'ot_total' and o.orders_status = s.orders_status_id and s.language_id = '" . (int)$languages_id . "' order by orders_id desc");
		while ($orders = tep_db_fetch_array($orders_query)) {
			if (tep_not_null($orders['delivery_name'])) {
				$order_name = $orders['delivery_name'];
				$order_country = $orders['delivery_country'];
			} else {
				$order_name = $orders['billing_name'];
				$order_country = $orders['billing_country'];
			}
	?>
				<tr>
					<td style="width: 170px;"><strong><?php echo $orders['orders_id']; ?></strong></td>
					<td style="width: 205px;"><?php echo tep_date_short($orders['date_purchased']); ?></td>
					<td style="width: 100px;"><?php echo $orders['order_total']; ?></td>
					<td style="width: 158px;"><?php echo $orders['orders_status_name']; ?></td>
					<td><?php echo '<a href="' . tep_href_link(FILENAME_ACCOUNT_HISTORY_INFO, 'order_id=' . $orders['orders_id'], 'SSL') . '">' . tep_image_button('button_order_details.gif', SMALL_IMAGE_BUTTON_VIEW) . '</a>'; ?></td>
				</tr>
	<?php
		}
	?>
			</table>
			</div>
		</div>
	</div>
	<?php } ?>

	<div class="account-block border">
		<div class="header">Account Information</div>
		<div class="content">
			<?php echo tep_draw_form('account_edit', tep_href_link(FILENAME_ACCOUNT, '', 'SSL'), 'post') . tep_draw_hidden_field('action', 'account'); ?>
			<table cellpadding="4" cellspacing="0">
				<tr>
					<th><?php echo (tep_not_null(ENTRY_FIRST_NAME_TEXT) ? '<span class="inputRequirement">' . ENTRY_FIRST_NAME_TEXT . '</span>&nbsp;': ''); ?>First Name</th>
					<th><?php echo (tep_not_null(ENTRY_LAST_NAME_TEXT) ? '<span class="inputRequirement">' . ENTRY_LAST_NAME_TEXT . '</span>&nbsp;': ''); ?>Last Name</th>
					<th><?php echo (tep_not_null(ENTRY_EMAIL_ADDRESS_TEXT) ? '<span class="inputRequirement">' . ENTRY_EMAIL_ADDRESS_TEXT . '</span>&nbsp;': ''); ?>Email Address</th>
					<th><?php echo (tep_not_null(ENTRY_TELEPHONE_NUMBER_TEXT) ? '<span class="inputRequirement">' . ENTRY_TELEPHONE_NUMBER_TEXT . '</span>&nbsp;': ''); ?>Phone Number</th>
					<th></th>
				</tr>
				<tr>
					<td align="center"><?php echo tep_draw_input_field('firstname', $account['customers_firstname']); ?></td>
					<td align="center"><?php echo tep_draw_input_field('lastname', $account['customers_lastname']); ?></td>
					<td align="center"><?php echo tep_draw_input_field('email_address', $account['customers_email_address']); ?></td>
					<td align="center"><?php echo tep_draw_input_field('telephone', $account['customers_telephone']); ?></td>
					<td align="center"><?php echo tep_image_submit('button_update_small.gif', 'Submit changes'); ?></td>
				</tr>
			</table>
			</form>
		</div>
	</div>

	<div class="account-block border">
		<div class="header">My Address Book</div>
		<div class="content">
			<table cellpadding="4" cellspacing="0" class="addresses">
				<tr>
					<th><span style="color:#009900">Primary Address</span></th>
					<th>Address #2</th>
					<th>Address #3</th>
					<th>Address #4</th>
					<th>Address #5</th>
					<th></th>
				</tr>
				<tr>
					<?php for ($i=0; $i<5; $i++) { ?>
					<td>
						<?php if (isset($addresses[$i])) { ?>
						<div style="height: 100px;"><?php echo tep_address_format($addresses[$i]['format_id'], $addresses[$i], true, ' ', '<br />'); ?></div>
						<div><?php echo '<a href="#" class="toggleAddress'. $addresses[$i]['address_book_id'] .'">' . tep_image_button('small_edit.gif', 'edit') . '</a> <a href="' . tep_href_link('account.php', 'action=deleteABentry&id=' . $addresses[$i]['address_book_id'], 'SSL') . '">' . tep_image_button('small_delete.gif', 'delete') . '</a>'; ?></div>
						
						<div id="addressDialog<?php echo $addresses[$i]['address_book_id']; ?>">
							<?php echo tep_draw_form('address_book_update', tep_href_link('address_book_process.php', 'edit='. $addresses[$i]['address_book_id'], 'SSL'), 'post', 'id="addAddress'. $addresses[$i]['address_book_id'] .'"'); ?>
								<?php echo tep_draw_hidden_field('action', 'update'); ?>
								<table cellpadding="4" cellspacing="1" class="table1" style="width: 300px;">
									<tr class="even">
										<td>First Name:<span class="inputRequirement">*</span></td>
										<td><?php echo tep_draw_input_field('firstname', $addresses[$i]['firstname']); ?></td>
									</tr>
									<tr class="odd">
										<td>Last Name:<span class="inputRequirement">*</span></td>
										<td><?php echo tep_draw_input_field('lastname', $addresses[$i]['lastname']); ?></td>
									</tr>
									<tr class="even">
										<td>Company Name:</td>
										<td><?php echo tep_draw_input_field('company', $addresses[$i]['company']); ?></td>
									</tr>
									<tr class="odd">
										<td>Street Address:<span class="inputRequirement">*</span></td>
										<td><?php echo tep_draw_input_field('street_address', $addresses[$i]['street_address']); ?></td>
									</tr>
									<tr class="even">
										<td>Apartment/Suite:</td>
										<td><?php echo tep_draw_input_field('suburb', $addresses[$i]['suburb']); ?></td>
									</tr>
									<tr class="odd">
										<td>City:<span class="inputRequirement">*</span></td>
										<td><?php echo tep_draw_input_field('city', $addresses[$i]['city']); ?></td>
									</tr>
									<tr class="even">
										<td>State/Province:<span class="inputRequirement">*</span></td>
										<td>
										<?php
											foreach ($pulldownarray as $country) {
												if (in_array($country['id'], array(38, 223))) {
													echo tep_draw_pull_down_menu('zone_id', $country['zones'], $addresses[$i]['zone_id'], 'class="zone'. $addresses[$i]['address_book_id'] .'" id="zone'. $addresses[$i]['address_book_id'] .'_'. $country['id'].'" style="'. ($addresses[$i]['country_id'] == $country['id']? '':'display: none;') .'width: 175px;"');
												}
											}
										?>
										</td>
									</tr>
									<tr class="odd">
										<td>Zip Code:<span class="inputRequirement">*</span></td>
										<td><?php echo tep_draw_input_field('postcode', $addresses[$i]['postcode']); ?></td>
									</tr>
									<tr class="even">
										<td>Country:<span class="inputRequirement">*</span></td>
										<td><?php echo tep_draw_pull_down_menu('country', $pulldownarray, $addresses[$i]['country_id'], 'id="country'. $addresses[$i]['address_book_id'] .'" style="width: 175px;"'); ?></td>
									</tr>
									<?php if (($customer_default_address_id != $addresses[$i]['address_book_id'])) { ?>
									<tr class="odd">
										<td>Primary address:</td>
										<td><?php echo tep_draw_checkbox_field('primary', 'on', false, 'id="primary"'); ?></td>
									</tr>
									<?php } ?>
									<tr class="even">
										<td colspan="2" align="right" style="padding-top: 10px; padding-right: 10px;"><?php echo tep_image_submit('button_update_small.gif', 'update'); ?></td>
									</tr>
								</table>
							</form>
						</div>
						<script type="text/javascript">
							$(document).ready(function() {
						    $("#addressDialog<?php echo $addresses[$i]['address_book_id']; ?>").dialog({
						        bgiframe: true,
						        autoOpen: false,
						        height: 370,
						        width: 355,
						        modal: true,
						        title:'Address book entry'
						    });
								$('a.toggleAddress<?php echo $addresses[$i]['address_book_id']; ?>').click(function(event) {
									event.preventDefault();
									$('#addressDialog<?php echo $addresses[$i]['address_book_id']; ?>').dialog('open');
								});
								
								$('#country<?php echo $addresses[$i]['address_book_id']; ?>').change(function () {
									$('.zone<?php echo $addresses[$i]['address_book_id']; ?>').attr("disabled","disabled").hide();
									val = $('#country<?php echo $addresses[$i]['address_book_id']; ?>').val();
									$('#zone<?php echo $addresses[$i]['address_book_id']; ?>_'+val).attr("disabled","").show();
								});
								
								$("#addAddress<?php echo $addresses[$i]['address_book_id']; ?>").submit(function() {
									return checkInputs(<?php echo $addresses[$i]['address_book_id']; ?>);
								});
							});
								
							$('.zone<?php echo $addresses[$i]['address_book_id']; ?>').attr("disabled","disabled").hide();
							val = $('#country<?php echo $addresses[$i]['address_book_id']; ?>').val();
							$('#zone<?php echo $addresses[$i]['address_book_id']; ?>_'+val).attr("disabled","").show();
							
						</script>
						<?php } else { ?>
						<div style="text-align: center;height: 100px;"><strong>NONE</strong></div>
							<?php if (tep_count_customer_address_book_entries() < MAX_ADDRESS_BOOK_ENTRIES) { ?>
							<div style="text-align: center;"><a href="#" class="toggleAddress<?php echo $i; ?>"><?php echo tep_image_button('button_add.gif', IMAGE_BUTTON_ADD_ADDRESS) ?></a></div>
							<?php } ?>
							
							<div id="addressDialog<?php echo $i; ?>">
								<?php echo tep_draw_form('address_book_add', tep_href_link('address_book_process.php', '', 'SSL'), 'post', 'id="addAddress'. $i .'"'); ?>
									<?php echo tep_draw_hidden_field('action', 'process'); ?>
									<table cellpadding="4" cellspacing="1" class="table1" style="width: 300px;">
										<tr class="even">
											<td>First Name:<span class="inputRequirement">*</span></td>
											<td><?php echo tep_draw_input_field('firstname'); ?></td>
										</tr>
										<tr class="odd">
											<td>Last Name:<span class="inputRequirement">*</span></td>
											<td><?php echo tep_draw_input_field('lastname'); ?></td>
										</tr>
										<tr class="even">
											<td>Company Name:</td>
											<td><?php echo tep_draw_input_field('company'); ?></td>
										</tr>
										<tr class="odd">
											<td>Street Address:<span class="inputRequirement">*</span></td>
											<td><?php echo tep_draw_input_field('street_address'); ?></td>
										</tr>
										<tr class="even">
											<td>Apartment/Suite:</td>
											<td><?php echo tep_draw_input_field('suburb'); ?></td>
										</tr>
										<tr class="odd">
											<td>City:<span class="inputRequirement">*</span></td>
											<td><?php echo tep_draw_input_field('city'); ?></td>
										</tr>
										<tr class="even">
											<td>State/Province:<span class="inputRequirement">*</span></td>
											<td>
											<?php
												foreach ($pulldownarray as $country) {
													if (in_array($country['id'], array(38, 223))) {
														echo tep_draw_pull_down_menu('zone_id', $country['zones'], 0, 'class="zone'. $i .'" id="zone'. $i .'_'. $country['id'].'" style="'. (223 == $country['id']? '':'display: none;') .'width: 175px;"');
													}
												}
											?>
											</td>
										</tr>
										<tr class="odd">
											<td>Zip Code:<span class="inputRequirement">*</span></td>
											<td><?php echo tep_draw_input_field('postcode'); ?></td>
										</tr>
										<tr class="even">
											<td>Country:<span class="inputRequirement">*</span></td>
											<td><?php echo tep_draw_pull_down_menu('country', $pulldownarray, 223, 'id="country'. $i .'" style="width: 175px;"'); ?></td>
										</tr>
										<tr class="odd">
											<td>Primary address:</td>
											<td><?php echo tep_draw_checkbox_field('primary', 'on', false, 'id="primary"'); ?></td>
										</tr>
										<tr class="even">
											<td colspan="2" align="right" style="padding-top: 10px; padding-right: 10px;"><?php echo tep_image_submit('button_add.gif', 'add'); ?></td>
										</tr>
									</table>
								</form>
							</div>
							<script type="text/javascript">
								$(document).ready(function() {
							    $("#addressDialog<?php echo $i; ?>").dialog({
							        bgiframe: true,
							        autoOpen: false,
							        height: 380,
							        width: 355,
							        modal: true,
							        title:'Address book entry'
							    });
									$('a.toggleAddress<?php echo $i; ?>').click(function(event) {
										event.preventDefault();
										$('#addressDialog<?php echo $i; ?>').dialog('open');
									});
									
									$('#country<?php echo $i; ?>').change(function () {
										$('.zone<?php echo $i; ?>').attr("disabled","disabled").hide();
										val = $('#country<?php echo $i; ?>').val();
										$('#zone<?php echo $i; ?>_'+val).attr("disabled","").show();
									});
									
									$("#addAddress<?php echo $i; ?>").submit(function() {
										return checkInputs(<?php echo $i; ?>);
									});
								});
								
								$('.zone<?php echo $i; ?>').attr("disabled","disabled").hide();
								val = $('#country<?php echo $i; ?>').val();
								$('#zone<?php echo $i; ?>_'+val).attr("disabled","").show();
							</script>
						<?php } ?>
					</td>
					<?php } ?>
				</tr>
			</table>
			<script type="text/javascript">
				function checkInputs(aId) {
					valid = true;
					if ($('#addressDialog'+aId+' input[name=firstname]').val().length < <?php echo ENTRY_FIRST_NAME_MIN_LENGTH; ?>) {
						valid = false;
						$('#addressDialog'+aId+' input[name=firstname]').addClass('errorInput');
					}
					else {
						$('#addressDialog'+aId+' input[name=firstname]').removeClass('errorInput');
					}
					
					if ($('#addressDialog'+aId+' input[name=lastname]').val().length < <?php echo ENTRY_LAST_NAME_MIN_LENGTH; ?>) {
						valid = false;
						$('#addressDialog'+aId+' input[name=lastname]').addClass('errorInput');
					}
					else {
						$('#addressDialog'+aId+' input[name=lastname]').removeClass('errorInput');
					}
					
					if ($('#addressDialog'+aId+' input[name=street_address]').val().length < <?php echo ENTRY_STREET_ADDRESS_MIN_LENGTH; ?>) {
						valid = false;
						$('#addressDialog'+aId+' input[name=street_address]').addClass('errorInput');
					}
					else {
						$('#addressDialog'+aId+' input[name=street_address]').removeClass('errorInput');
					}
					
					if ($('#addressDialog'+aId+' input[name=postcode]').val().length < <?php echo ENTRY_POSTCODE_MIN_LENGTH; ?>) {
						valid = false;
						$('#addressDialog'+aId+' input[name=postcode]').addClass('errorInput');
					}
					else {
						$('#addressDialog'+aId+' input[name=postcode]').removeClass('errorInput');
					}
					
					if ($('#addressDialog'+aId+' input[name=city]').val().length < <?php echo ENTRY_CITY_MIN_LENGTH; ?>) {
						valid = false;
						$('#addressDialog'+aId+' input[name=city]').addClass('errorInput');
					}
					else {
						$('#addressDialog'+aId+' input[name=city]').removeClass('errorInput');
					}
					
					if (valid) {
						return true;
					}
					else {
						return false;
					}
				};
			</script>
		</div>
	</div>

	<div class="account-block border">
		<div class="header">Change Password</div>
		<div class="content">
			<?php echo tep_draw_form('account_edit', tep_href_link(FILENAME_ACCOUNT, '', 'SSL'), 'post') . tep_draw_hidden_field('action', 'passwd'); ?>
			<table cellpadding="4" cellspacing="0">
				<tr>
					<th><span class="inputRequirement">*</span>&nbsp;Current Password</th>
					<th><span class="inputRequirement">*</span>&nbsp;New Password</th>
					<th><span class="inputRequirement">*</span>&nbsp;Password Confirmation</th>
					<th></th>
				</tr>
				<tr>
					<td align="center"><?php echo tep_draw_password_field('password_current'); ?></td>
					<td align="center"><?php echo tep_draw_password_field('password_new'); ?></td>
					<td align="center"><?php echo tep_draw_password_field('password_confirmation'); ?></td>
					<td align="center"><?php echo tep_image_submit('button_update_small.gif', 'Submit changes'); ?></td>
				</tr>
			</table>
			</form>
		</div>
	</div>

<!-- // Points/Rewards Module V2.00 points_system_box_bof //-->
<?php 	
    if (USE_POINTS_SYSTEM == 'true') { // check that the points system is enabled
?>
		<table border="0" width="100%" cellspacing="0" cellpadding="0">
      <tr>
        <td><?php echo tep_draw_separator('pixel_trans.gif', '100%', '10'); ?></td>
      </tr>
      <tr>
        <td><table border="0" width="100%" cellspacing="0" cellpadding="2">
          <tr>
            <td class="main"><b><?php echo MY_POINTS_TITLE; ?></b></td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td><table border="0" width="100%" cellspacing="1" cellpadding="2" class="infoBox">
          <tr class="infoBoxContents">
            <td><table border="0" width="100%" cellspacing="0" cellpadding="2">
              <tr>
                <td width="10"><?php echo tep_draw_separator('pixel_trans.gif', '10', '1'); ?></td>
                <td width="60"><?php echo tep_image(DIR_WS_IMAGES . 'money.gif'); ?></td>
                <td width="10"><?php echo tep_draw_separator('pixel_trans.gif', '10', '1'); ?></td>
                <td><table border="0" width="100%" cellspacing="0" cellpadding="2">
<?php
  $shopping_points = tep_get_shopping_points();
  if ($shopping_points > 0) {
?>
                  <tr>
                    <td class="main"><?php echo tep_image(DIR_WS_IMAGES . 'indicator.gif') .'&nbsp;&nbsp;'.  sprintf(MY_POINTS_CURRENT_BALANCE, number_format($shopping_points,POINTS_DECIMAL_PLACES),$currencies->format(tep_calc_shopping_pvalue($shopping_points))); ?></td>
<?php
  }
?>
                  <tr>
                    <td class="main"><?php echo tep_image(DIR_WS_IMAGES . 'arrow_green.gif') . ' <a href="' . tep_href_link(FILENAME_MY_POINTS, '', 'SSL') . '">' . MY_POINTS_VIEW . '</a>'; ?></td>
                  </tr>
                  <tr>
                    <td class="main"><?php echo tep_image(DIR_WS_IMAGES . 'arrow_green.gif') . ' <a href="' . tep_href_link(FILENAME_MY_POINTS_HELP, '', 'SSL') . '">' . MY_POINTS_VIEW_HELP . '</a>'; ?></td>
                  </tr>
                </table></td>
                <td width="10" align="right"><?php echo tep_draw_separator('pixel_trans.gif', '10', '1'); ?></td>
              </tr>
            </table></td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td><?php echo tep_draw_separator('pixel_trans.gif', '100%', '10'); ?></td>
      </tr>
    </table>
<?php 
  }// else do not show points_system_box
?>
<!-- // Points/Rewards Module V2.00 points_system_box_eof //-->
